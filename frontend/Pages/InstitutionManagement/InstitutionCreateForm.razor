@using MudBlazor
@using Shared.Manager
@using System.Text.Json
@using System.IO
@using Microsoft.Extensions.Configuration;
@inherits CreateForm<Institution>

<MudForm @ref="_form">
    <MudCard>
        <MudCardContent>
            <InstitutionFormCommonComponents Institution="_precreateItem" />
            <MudCardActions>
            <MudSelect Required="@true" T="int?" @bind-Value="userId"
                Placeholder="Select user to make admin">
                @foreach (User user in _UserList)
                {
                    <MudSelectItem Value="@(user.id)">@user.firstName @user.lastName</MudSelectItem>
                }
            </MudSelect>
                <MudButton Variant="Variant.Filled" Color="Color.Primary" @onclick="createInst"
                    FullWidth="true">Add Institution</MudButton>
            </MudCardActions>
            <MudCardActions>
                <MudButton FullWidth="true" @onclick="OnCancel" Variant="Variant.Filled"
                    Color="Color.Warning">Cancel</MudButton>
            </MudCardActions>
        </MudCardContent>
    </MudCard>
</MudForm>

@code
{
    private List<User> _UserList = new List<User>();
    private int? userId;

    protected async Task createInst()
        {
            _precreateItem.admin = await RequestHandler<User, User>(HttpMethod.Get, "/Users/" + Convert.ToString(userId),inst.admin);
            await OnRequestAction(HttpMethod.Post, ManagerService.ApiPath, inst, validate: true);
        }

    protected override async Task OnInitializedAsync()
    {
        _UserList = await RequestHandler<None, List<User>>(HttpMethod.Get, "/Users");
    }
}