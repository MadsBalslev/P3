@page "/posterscreenzzz"
@using System
@using System.Collections.Generic
@using frontend.Shared.Layout
@layout PosterScreenLayout

<div class="container">
    <div class="loading" hidden=@hidetext>
        <h1> Loading picture number: @currentPicture ...</h1>
    </div>
    <div class="imgContainer" hidden=@hidepicture>
        <img class="poster" src="@imageSource">
    </div>
</div>



@code
{
    System.Timers.Timer ImageTimer;
    int currentPicture = 0;
    bool hidepicture = true;
    bool hidetext = false;
    string imageSource { get => Posters[currentPicture]; }

    List<string> Posters = new List<string>
{
"/images/nordkraft.jpg",
"/images/pointer.png",
"/images/pointerpointer.png",
};


    @* string createPoster()
        {
        Poster picture1 = new Poster("Film plakat", "Patrick", "Nordkraft");
        picture1.ImageUrl = "https://cdn.discordapp.com/attachments/755020353201373244/902461379485790238/tlvvhv1sum641.png";
        return picture1.ImageUrl;
        }

        string showPoster()
        {
        return createPoster();
        } *@

    void nextPic(Object source, System.Timers.ElapsedEventArgs e)
    {
        if ((currentPicture < Posters.Count - 1)) { currentPicture += 1; }
        else currentPicture = 0;
        InvokeAsync(StateHasChanged);
    }

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            cachePictures();

            ImageTimer = new System.Timers.Timer(4000);
            ImageTimer.Elapsed += nextPic;
            ImageTimer.AutoReset = true;
            ImageTimer.Start();
        }
    }

    void cachePictures()
    {
        int cachenumber = 0;

        while (cachenumber < Posters.Count - 1)
        {
            System.Threading.Thread.Sleep(400);
            cachenumber++;
            currentPicture++;
            InvokeAsync(StateHasChanged);

            if (cachenumber == Posters.Count - 1)
            {
                hidepicture = false;
                hidetext = true;
            }
        }
    }
}
